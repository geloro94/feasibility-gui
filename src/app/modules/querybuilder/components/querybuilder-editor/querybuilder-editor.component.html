<div class="header-line">
  <div style="padding-top: 2em">
    <mat-accordion>
      <mat-expansion-panel [expanded]="true" class="mat-elevation-z3">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <div fxFill fxLayout="row" fxLayoutAlign="space-between center">
              <div fxLayout="row" fxLayoutAlign="space-between center" class="result-header-line">
                <num-result-simple
                  class="result-simple-box"
                  [resultObservable]="resultObservable$"
                  [result]="result"
                  [showSpinner]="showSpinningIcon"
                  [isResultLoaded]="loadedResult"
                  [gottenDetailedResult]="gottenDetailedResult"
                  [resultUrl]="resultUrl"
                  [callsRemaining]="callsRemaining"
                  [callsLimit]="callsLimit"
                  (resultGotten)="updateResultGotten($event)"
                ></num-result-simple>
              </div>
            </div>
          </mat-panel-title>
          <mat-panel-title style="width: 50%">
            <div
              fxLayout="column"
              fxLayoutAlign="space-between"
              class="query-buttons-box"
              style="width: 100%"
            >
              <div fxLayout="row" fxLayoutAlign="end">
                <num-button
                  [type]="'primary'"
                  [isDisabled]="actionDisabledReset"
                  (click)="!actionDisabledReset && doReset(); $event.stopPropagation()"
                  class="button-reset"
                >
                  {{ 'BUTTON.RESET' | translate }}
                </num-button>
                <num-button
                  [type]="'primary'"
                  [isDisabled]="actionDisabledReset"
                  (click)="!actionDisabledReset && doSave(); $event.stopPropagation()"
                  class="button-save"
                >
                  {{ 'BUTTON.SAVEQUERY' | translate }}
                </num-button>
                <num-button
                  [type]="'primary'"
                  [isDisabled]="actionDisabledSend"
                  (click)="!actionDisabledSend && doSend(); $event.stopPropagation()"
                  class="button-send"
                >
                  {{ 'BUTTON.SEND' | translate }}
                </num-button>
              </div>
              <div
                *ngIf="actionDisabledSend && !actionDisabledReset"
                class="send-button-alert-text"
              >
                {{ 'QUERYBUILDER.HINT.NO_CRITERIA_SELECTED' | translate }}
              </div>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <h3 class="consent-header">{{ 'QUERYBUILDER.SEARCH.CONSENT_HEADER' | translate }}</h3>
        <div class="container-consent">
          <div>
            <mat-radio-group
              class="consent-radio-group"
              (change)="setConsent($event)"
              [(ngModel)]="query.consent"
            >
              <mat-radio-button class="consent-radio-button" [value]="true">
                <a
                  target="_blank"
                  href="https://www.medizininformatik-initiative.de/de/mustertext-zur-patienteneinwilligung"
                >
                  {{ 'QUERYBUILDER.SEARCH.CONSENT_CENTRAL_LINK' | translate }}
                </a>
                {{ 'QUERYBUILDER.SEARCH.CONSENT_CENTRAL' | translate }}
                <fa-icon
                  size="1x"
                  [matTooltip]="'QUERYBUILDER.SEARCH.CONSENT_CENTRAL_TOOLTIP' | translate"
                  matTooltipPosition="right"
                  icon="question-circle"
                ></fa-icon>
              </mat-radio-button>
              <mat-radio-button class="consent-radio-button" [value]="false"
                >{{ 'QUERYBUILDER.SEARCH.CONSENT_DISTRIBUTED' | translate }}
                <fa-icon
                  size="1x"
                  [matTooltip]="'QUERYBUILDER.SEARCH.CONSENT_DISTRIBUTED_TOOLTIP' | translate"
                  matTooltipPosition="right"
                  icon="question-circle"
                ></fa-icon>
              </mat-radio-button>
            </mat-radio-group>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <mat-card class="mat-elevation-z3 margin-top-2">
    <div fxFill class="mat-elevation-z3">
      <mat-card-header class="header-label">
        {{ 'QUERYBUILDER.OVERVIEW.HEADER' | translate }}
      </mat-card-header>
      <div fxFill fxLayout="row" fxLayoutAlign="space-between">
        <mat-card-header fxFlex="48.5">
          <num-search-input
            fxFill
            [searchType]="'querybuilder'"
            [critType]="'inclusion'"
            [query]="query"
            class="search-input-inclusion"
          ></num-search-input>
        </mat-card-header>
        <mat-divider [vertical]="true"></mat-divider>
        <mat-card-header fxFlex="48.5">
          <num-search-input
            fxFill
            [searchType]="'querybuilder'"
            [critType]="'exclusion'"
            [query]="query"
            class="search-input-exclusion"
          ></num-search-input>
        </mat-card-header>
      </div>
      <mat-card-content>
        <num-display-query
          [searchType]="'querybuilder'"
          [query]="query"
          (storeQuery)="storeQuery($event)"
        >
        </num-display-query>
        <div *ngIf="featureService.useFeatureMultipleGroups()">
          <button class="button-add-group" type="button" mat-icon-button (click)="addGroup()">
            <fa-icon icon="plus" size="lg"></fa-icon>
          </button>
          {{ 'QUERYBUILDER.DISPLAY.GROUPS.NEW_GROUP' | translate }}
        </div>
      </mat-card-content>
    </div>
  </mat-card>
</div>
